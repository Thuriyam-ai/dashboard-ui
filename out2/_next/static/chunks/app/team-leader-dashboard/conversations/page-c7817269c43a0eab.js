(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[730],{67:function(){},2061:function(){},8323:function(e,t,r){Promise.resolve().then(r.bind(r,8847))},8847:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return en}});var n=r(7437),a=r(2265),o=r(9376),s=r(4753),i=r(3397),l=r(5122),c=r(9969),d=r(8543),h=r(9083),u=r(5666),x=r(5545),m=r(658),g=r(2854),p=r(7639),f=r(1504),Z=r(1563),j=r(1002),v=r(1835),y=r(7792),w=r(2347),_=r(6425),b=r(9318),C=r(5280),S=r(8319),E=r(9352),k=r(2995),W=r(8654),D=r(8045),I=r(6838),O=r(6116),F=r(6382),P=r(6875),A=r(5338),N=r(793),L=r(1096),M=r(2961),z=r(7367),T=r(4589),G=r(7306),R=r(1200),B=r(2141),U=r(9391),Q=r(2192),q=r(3977),J=r(9636),H=r(3821),K=r(3250),V=r(47),$=r(6873),X=r(4881),Y=r(6159),ee=r(1273),et=r(7856),er=r(2093);function en(){let e=(0,o.useRouter)(),{logout:t}=(0,X.a)(),r=(0,l.Z)();(0,c.Z)(r.breakpoints.down("md"));let[en,ea]=(0,a.useState)(!1),eo=()=>{ea(!en)},[es,ei]=(0,a.useState)(""),[el,ec]=(0,a.useState)("all"),[ed,eh]=(0,a.useState)("all"),[eu,ex]=(0,a.useState)([]),[em,eg]=(0,a.useState)(!0),[ep,ef]=(0,a.useState)(null),[eZ,ej]=(0,a.useState)([]),[ev,ey]=(0,a.useState)(!0),[ew,e_]=(0,a.useState)(null),[eb,eC]=(0,a.useState)([]),[eS,eE]=(0,a.useState)(!0),[ek,eW]=(0,a.useState)(null),[eD,eI]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{eg(!0),ey(!0);let[e,t]=await Promise.all([(0,Y.E6)(),(0,ee.q)()]);ex(e),ej(t)}catch(e){console.error("Failed to fetch filter data:",e),ef("Could not load campaigns."),e_("Could not load teams.")}finally{eg(!1),ey(!1)}})()},[]),(0,a.useEffect)(()=>{(async()=>{eE(!0),eW(null);try{let e=await (0,et.Gl)({campaign_id:"all"===el?void 0:el,team_id:"all"===ed?void 0:ed});eC(e)}catch(e){console.error("Failed to fetch conversations:",e),eW("Failed to load conversations. Please try again.")}finally{eE(!1)}})()},[el,ed]);let eO=(0,a.useMemo)(()=>new Map(eZ.map(e=>[e.id,e.name])),[eZ]),eF=(0,a.useMemo)(()=>eb.filter(e=>e.agent_id.toLowerCase().includes(es.toLowerCase())||e.employer_user_id.toLowerCase().includes(es.toLowerCase())||e.conversation_id.toLowerCase().includes(es.toLowerCase())),[eb,es]),eP=(0,a.useMemo)(()=>{if(0===eF.length)return{total:0,completed:0,avgScore:0,avgDuration:0};let e=eF.filter(e=>{var t;return(null===(t=e.avyukta_status)||void 0===t?void 0:t.toUpperCase())==="COMPLETED"}).length,t=eF.filter(e=>"number"==typeof e.QC_score),r=t.reduce((e,t)=>e+(t.QC_score||0),0),n=t.length>0?Math.round(r/t.length):0,a=eF.reduce((e,t)=>e+(t.length_in_sec||0),0)/eF.length;return{total:eF.length,completed:e,avgScore:n,avgDuration:Math.round(a/60)}},[eF]),eA=e=>{switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":return"success";case"IN-PROGRESS":return"info";case"FAILED":return"error";default:return"default"}},eN=e=>{switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":return(0,n.jsx)(M.Z,{});case"IN-PROGRESS":return(0,n.jsx)(z.Z,{});case"FAILED":return(0,n.jsx)(T.Z,{});default:return(0,n.jsx)(G.Z,{})}},eL=e=>e>=80?"success.main":e>=60?"warning.main":"error.main",eM=e=>{let t="string"==typeof e?e:null==e?void 0:e.$date;if(!t)return"-";let r=new Date(t);return isNaN(r.getTime())?"-":r.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})},ez=e=>isNaN(e)||e<0?"0:00":"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),eT=t=>{e.push("/team-leader-dashboard/conversation-detail?id=".concat(t))};return(0,n.jsxs)(d.Z,{sx:{display:"flex",minHeight:"100vh",backgroundColor:"background.default"},children:[(0,n.jsx)(s.q,{activeItem:"conversations",drawerWidth:280,mobileOpen:en,onDrawerToggle:eo}),(0,n.jsxs)(d.Z,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",width:{xs:"100%",md:"calc(100% - ".concat(280,"px)")},marginLeft:{md:"".concat(280,"px")}},children:[(0,n.jsx)(h.Z,{position:"static",elevation:1,sx:{backgroundColor:"background.paper",color:"text.primary",borderBottom:"1px solid",borderColor:"divider"},children:(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(x.Z,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:eo,sx:{mr:2,display:{md:"none"}},children:(0,n.jsx)(R.Z,{})}),(0,n.jsx)(d.Z,{sx:{flexGrow:1},children:(0,n.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"monospace",color:"text.secondary"},children:"team-leader-dashboard-conversations.localhost:3000"})}),(0,n.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,n.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},children:(0,n.jsx)(B.Z,{})}),(0,n.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:1,mr:2},children:[(0,n.jsx)(g.Z,{sx:{width:32,height:32,bgcolor:"primary.main",fontSize:"0.875rem"},children:"W"}),(0,n.jsx)(m.Z,{variant:"body2",fontWeight:500,children:"Work"})]}),(0,n.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},children:(0,n.jsx)(U.Z,{})}),(0,n.jsx)(p.Z,{variant:"contained",color:"error",size:"small",startIcon:(0,n.jsx)(Q.Z,{}),sx:{ml:1},onClick:t,children:"Logout"})]})]})}),(0,n.jsxs)(f.Z,{maxWidth:"xl",sx:{flexGrow:1,py:3},children:[(0,n.jsx)(i.O,{}),(0,n.jsxs)(d.Z,{sx:{mb:4},children:[(0,n.jsx)(m.Z,{variant:"h3",component:"h1",fontWeight:700,gutterBottom:!0,children:"Conversations Management"}),(0,n.jsx)(m.Z,{variant:"h6",color:"text.secondary",children:"Monitor and analyze team conversations with comprehensive analytics"})]}),(0,n.jsx)(Z.Z,{sx:{mb:3},children:(0,n.jsx)(j.Z,{children:(0,n.jsxs)(d.Z,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"wrap"},children:[(0,n.jsx)(v.Z,{placeholder:"Search by ID, Agent, Customer...",value:es,onChange:e=>ei(e.target.value),InputProps:{startAdornment:(0,n.jsx)(y.Z,{position:"start",children:(0,n.jsx)(q.Z,{})})},sx:{minWidth:300,flexGrow:{xs:1,md:0}}}),(0,n.jsxs)(w.Z,{sx:{minWidth:150},disabled:em,children:[(0,n.jsx)(_.Z,{children:"Campaign"}),(0,n.jsxs)(b.Z,{value:el,label:"Campaign",onChange:e=>ec(e.target.value),children:[(0,n.jsx)(C.Z,{value:"all",children:"All Campaigns"}),eu.map(e=>(0,n.jsx)(C.Z,{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(w.Z,{sx:{minWidth:150},disabled:ev,children:[(0,n.jsx)(_.Z,{children:"Team"}),(0,n.jsxs)(b.Z,{value:ed,label:"Team",onChange:e=>eh(e.target.value),children:[(0,n.jsx)(C.Z,{value:"all",children:"All Teams"}),eZ.map(e=>(0,n.jsx)(C.Z,{value:e.id,children:e.name},e.id))]})]}),(0,n.jsx)(p.Z,{variant:"outlined",startIcon:(0,n.jsx)(J.Z,{}),onClick:()=>{ei(""),ec("all"),eh("all")},children:"Reset Filters"}),(0,n.jsx)(p.Z,{variant:"contained",startIcon:eD?(0,n.jsx)(S.Z,{size:20,color:"inherit"}):(0,n.jsx)(H.Z,{}),sx:{ml:"auto"},onClick:()=>{if(0===eF.length){alert("No data to export.");return}eI(!0);let e=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(let a in t)if(Object.prototype.hasOwnProperty.call(t,a)){let o=r?"".concat(r,".").concat(a):a,s=t[a];"object"!=typeof s||null===s||Array.isArray(s)?Array.isArray(s)?n[o]=JSON.stringify(s,null,2):n[o]=s:e(s,o,n)}return n};setTimeout(()=>{try{let t=eF.map(e=>{let t=JSON.parse(JSON.stringify(e));if(delete t.logging_comments,t.analytics_data){if(t.analytics_data.outcome){for(let e in t.analytics_data.outcome)if(Object.prototype.hasOwnProperty.call(t.analytics_data.outcome,e)){let r=t.analytics_data.outcome[e];t.analytics_data.outcome[e]={extracted_value:r.extracted_value,reasoning:r.reasoning,reviewer_value:r.reviewer_value,reviewer_reason:r.reviewer_reason}}}if(t.analytics_data.scorecard){for(let e in t.analytics_data.scorecard)if(Object.prototype.hasOwnProperty.call(t.analytics_data.scorecard,e)){let r=t.analytics_data.scorecard[e];t.analytics_data.scorecard[e]={score:r.score,explanation:r.explanation,max_score:r.max_score,review_score:r.review_score,reason_for_update:r.reason_for_update}}}let{analytics_data:e,...r}=t;return{...r,...e}}return t}).reduce((e,t)=>{let r=t.campaign_id||"Uncategorized";return e[r]||(e[r]=[]),e[r].push(t),e},{}),r=er.P6.book_new();for(let n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;let a=t[n].map(t=>e(t));if(0===a.length)continue;let o=Object.keys(a.reduce((e,t)=>({...e,...t}),{})),s=o.map(e=>e.split(".")),i=Math.max(...s.map(e=>e.length)),l=Array.from({length:i},()=>[]);o.forEach(e=>{let t=e.split(".");for(let e=0;e<i;e++)l[e].push(t[e]||"")});let c=a.map(e=>o.map(t=>{var r;return null!==(r=e[t])&&void 0!==r?r:""})),d=[...l,...c],h=er.P6.aoa_to_sheet(d),u=[];for(let e=0;e<i;++e)for(let t=0;t<l[e].length;++t){if(!l[e][t]||u.some(r=>e>=r.s.r&&e<=r.e.r&&t>=r.s.c&&t<=r.e.c))continue;let r=t;for(;r+1<l[e].length&&l[e][r+1]===l[e][t];){let n=!0;for(let a=0;a<e;a++)if(l[a][t]!==l[a][r+1]){n=!1;break}if(!n)break;r++}let n=e;for(;n+1<i&&!l[n+1][t];)n++;(e!==n||t!==r)&&u.push({s:{r:e,c:t},e:{r:n,c:r}})}h["!merges"]=u;let x=d[0]?d[0].length:0,m=Array.from({length:x},()=>({wch:10}));for(let e=0;e<x;++e){let t=0;for(let r=0;r<d.length;++r){let n=d[r][e],a=n?String(n).length:0;a>t&&(t=a)}m[e]={wch:Math.min(Math.max(t+2,10),60)}}h["!cols"]=m;let g=er.P6.decode_range(h["!ref"]);for(let e=g.s.r;e<=g.e.r;++e)for(let t=g.s.c;t<=g.e.c;++t){let r=h[er.P6.encode_cell({r:e,c:t})];r&&(r.s||(r.s={}),r.s.alignment||(r.s.alignment={}),r.s.alignment.wrapText=!0,r.s.alignment.vertical="top",e<i&&(r.s.fill||(r.s.fill={}),r.s.fill.fgColor={rgb:"FFFF00"},r.s.font||(r.s.font={}),r.s.font.bold=!0))}let p=eu.find(e=>e.id===n),f=((null==p?void 0:p.name)||n).replace(/[\/\\?*[\]:]/g,"").substring(0,31);er.P6.book_append_sheet(r,h,f)}let n=new Date().toISOString().split("T")[0];er.NC(r,"conversations_export_".concat(n,".xlsx"))}catch(e){console.error("Failed to export data:",e),alert("An error occurred while exporting the data.")}finally{eI(!1)}},100)},disabled:eD||0===eF.length,children:eD?"Exporting...":"Export Data"})]})})}),(0,n.jsxs)(E.Z,{container:!0,spacing:3,sx:{mb:4},children:[(0,n.jsx)(E.Z,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(Z.Z,{children:(0,n.jsx)(j.Z,{children:(0,n.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(m.Z,{color:"text.secondary",gutterBottom:!0,children:"Total Conversations"}),(0,n.jsx)(m.Z,{variant:"h4",fontWeight:700,color:"primary",children:eP.total})]}),(0,n.jsx)(K.Z,{sx:{fontSize:40,color:"primary.main"}})]})})})}),(0,n.jsx)(E.Z,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(Z.Z,{children:(0,n.jsx)(j.Z,{children:(0,n.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(m.Z,{color:"text.secondary",gutterBottom:!0,children:"Completed"}),(0,n.jsx)(m.Z,{variant:"h4",fontWeight:700,color:"success.main",children:eP.completed})]}),(0,n.jsx)(M.Z,{sx:{fontSize:40,color:"success.main"}})]})})})}),(0,n.jsx)(E.Z,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(Z.Z,{children:(0,n.jsx)(j.Z,{children:(0,n.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(m.Z,{color:"text.secondary",gutterBottom:!0,children:"Avg Quality Score"}),(0,n.jsx)(m.Z,{variant:"h4",fontWeight:700,color:"info.main",children:eP.avgScore})]}),(0,n.jsx)(V.Z,{sx:{fontSize:40,color:"info.main"}})]})})})}),(0,n.jsx)(E.Z,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(Z.Z,{children:(0,n.jsx)(j.Z,{children:(0,n.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(m.Z,{color:"text.secondary",gutterBottom:!0,children:"Avg Duration"}),(0,n.jsxs)(m.Z,{variant:"h4",fontWeight:700,color:"warning.main",children:[eP.avgDuration,"m"]})]}),(0,n.jsx)(z.Z,{sx:{fontSize:40,color:"warning.main"}})]})})})})]}),(0,n.jsx)(Z.Z,{children:(0,n.jsxs)(j.Z,{children:[(0,n.jsxs)(m.Z,{variant:"h5",fontWeight:600,gutterBottom:!0,sx:{mb:3},children:["Conversation Details (",eF.length," conversations)"]}),(0,n.jsx)(k.Z,{component:W.Z,variant:"outlined",children:(0,n.jsxs)(D.Z,{children:[(0,n.jsx)(I.Z,{children:(0,n.jsxs)(O.Z,{sx:{backgroundColor:"action.hover"},children:[(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Conversation ID"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Agent ID"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Customer ID"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Duration"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Date"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Status"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Quality Score"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Team"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Disposition"}),(0,n.jsx)(F.Z,{sx:{fontWeight:600},children:"Actions"})]})}),(0,n.jsx)(P.Z,{children:eS?(0,n.jsx)(O.Z,{children:(0,n.jsx)(F.Z,{colSpan:10,align:"center",children:(0,n.jsx)(S.Z,{})})}):ek?(0,n.jsx)(O.Z,{children:(0,n.jsx)(F.Z,{colSpan:10,children:(0,n.jsx)(A.Z,{severity:"error",children:ek})})}):0===eF.length?(0,n.jsx)(O.Z,{children:(0,n.jsx)(F.Z,{colSpan:10,align:"center",children:"No conversations found for the selected filters."})}):eF.map(e=>{let t=e.QC_score,r=e.call_timestamp;return(0,n.jsxs)(O.Z,{children:[(0,n.jsx)(F.Z,{children:(0,n.jsx)(m.Z,{variant:"body2",fontWeight:600,children:e.conversation_id})}),(0,n.jsx)(F.Z,{children:e.agent_id}),(0,n.jsx)(F.Z,{children:e.employer_user_id}),(0,n.jsx)(F.Z,{children:ez(e.length_in_sec)}),(0,n.jsx)(F.Z,{children:eM(r)}),(0,n.jsx)(F.Z,{children:(0,n.jsx)(N.Z,{icon:eN(e.avyukta_status),label:e.avyukta_status||"Unknown",color:eA(e.avyukta_status),size:"small"})}),(0,n.jsx)(F.Z,{children:"number"==typeof t?(0,n.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(m.Z,{variant:"body2",fontWeight:600,color:eL(t),children:t}),(0,n.jsx)(L.Z,{variant:"determinate",value:t,sx:{width:50,height:6,borderRadius:3},color:t>=80?"success":t>=50?"warning":"error"})]}):(0,n.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"-"})}),(0,n.jsx)(F.Z,{children:(0,n.jsx)(N.Z,{label:eO.get(e.team_id)||"Unknown",size:"small",variant:"outlined"})}),(0,n.jsx)(F.Z,{children:e.lamh_disposition}),(0,n.jsx)(F.Z,{children:(0,n.jsx)(p.Z,{size:"small",startIcon:(0,n.jsx)($.Z,{}),variant:"outlined",onClick:()=>eT(e.conversation_id),children:"View Details"})})]},e.conversation_id)})})]})})]})})]})]})]})}},6159:function(e,t,r){"use strict";r.d(t,{E6:function(){return a},QF:function(){return s},bO:function(){return o},hm:function(){return l},mK:function(){return i}});var n=r(4633);let a=async function(){let{skip:e=0,limit:t=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await n.Z.get("/api/v1/campaigns/",{params:{skip:e,limit:t}})).data}catch(e){throw console.error("Failed to fetch campaigns:",e),Error("Could not fetch campaigns.")}},o=async e=>{try{await n.Z.delete("/api/v1/campaigns/".concat(e))}catch(t){throw console.error("Failed to delete campaign ".concat(e,":"),t),Error("Could not delete the campaign.")}},s=async e=>{try{return(await n.Z.get("/api/v1/campaigns/".concat(e))).data}catch(t){throw console.error("Failed to fetch campaign ".concat(e,":"),t),Error("Could not fetch campaign details.")}},i=async e=>{try{return(await n.Z.post("/api/v1/campaigns/",e)).data}catch(e){throw console.error("Failed to create campaign:",e),Error("Could not create campaign.")}},l=async(e,t)=>{try{return(await n.Z.put("/api/v1/campaigns/".concat(e),t)).data}catch(t){throw console.error("Failed to update campaign ".concat(e,":"),t),Error("Could not update campaign.")}}},7856:function(e,t,r){"use strict";r.d(t,{Gl:function(){return a},Om:function(){return i},wS:function(){return o},wW:function(){return s}});var n=r(4633);let a=async e=>{let{campaignId:t,teamId:r,skip:a=0,limit:o=100}=e,s=new URLSearchParams({skip:a.toString(),limit:o.toString()});t&&"all"!==t&&s.append("campaign_id",t),r&&"all"!==r&&s.append("team_id",r);try{return(await n.Z.get("/api/v1/conversations/?".concat(s.toString()))).data}catch(e){throw console.error("Failed to fetch conversations:",e),Error("Could not fetch conversations data. Please try again.")}},o=async e=>{try{return(await n.Z.get("/api/v1/conversations/".concat(e))).data}catch(t){throw console.error("Failed to fetch conversation detail for ID: ".concat(e),t),Error("Could not fetch conversation details for ".concat(e,". Please try again."))}},s=async(e,t,r)=>{try{return(await n.Z.put("/api/v1/conversations/".concat(e,"/scorecard/").concat(t),r)).data}catch(e){throw console.error("Failed to submit scorecard review for parameter: ".concat(t),e),Error('Could not submit scorecard review for "'.concat(t,'". Please try again.'))}},i=async(e,t,r)=>{try{return(await n.Z.put("/api/v1/conversations/".concat(e,"/outcome/").concat(t),r)).data}catch(e){throw console.error("Failed to submit outcome review for attribute: ".concat(t),e),Error('Could not submit outcome review for "'.concat(t,'". Please try again.'))}}},1273:function(e,t,r){"use strict";r.d(t,{q:function(){return a}});var n=r(4633);let a=async()=>{try{return(await n.Z.get("/api/v1/goals/utils/teams")).data}catch(e){throw console.error("Failed to fetch teams:",e),Error("Could not fetch teams.")}}}},function(e){e.O(0,[334,425,103,118,362,835,41,4,865,645,21,971,117,744],function(){return e(e.s=8323)}),_N_E=e.O()}]);