(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{9935:function(e,a,t){Promise.resolve().then(t.bind(t,2899))},2899:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return q}});var n=t(7437),r=t(2265),i=t(9376),s=t(4753),l=t(3397),c=t(8543),o=t(9083),d=t(5666),u=t(5545),h=t(658),m=t(7639),g=t(8319),x=t(1504),p=t(5338),f=t(1563),j=t(1002),Z=t(9352),v=t(2347),y=t(1835),b=t(9391),w=t(9318),C=t(5280),S=t(5761),_=t(1442),I=t(1617),D=t(2517),k=t(1381),E=t(6159),F=t(1637),T=t(1273);let G=e=>e?e.split("T")[0]:"";function N(){let e=(0,i.useRouter)(),a=(0,i.useSearchParams)(),[t,N]=(0,r.useState)(!1),[q,O]=(0,r.useState)(null),[P,W]=(0,r.useState)("Create New Campaign"),[A,z]=(0,r.useState)(!0),[B,L]=(0,r.useState)(!1),[H,K]=(0,r.useState)(null),[Q,M]=(0,r.useState)({}),[R,U]=(0,r.useState)(""),[V,J]=(0,r.useState)(""),[X,Y]=(0,r.useState)(""),[$,ee]=(0,r.useState)(""),[ea,et]=(0,r.useState)(""),[en,er]=(0,r.useState)([]),[ei,es]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=a.get("id");(async()=>{try{let[a,t]=await Promise.all([(0,F.FV)(),(0,T.q)()]);er(a),es(t),e&&(N(!0),O(e),W("Edit Campaign"),await el(e))}catch(e){K("Failed to load necessary data. Please try again.")}finally{z(!1)}})()},[a]);let el=async e=>{let a=await (0,E.QF)(e);U(a.name),J(G(a.starts_at)),Y(G(a.ends_at)),ee(a.goal_id),et(a.team_id)},ec=()=>{let e={};R.trim()||(e.campaignName="Campaign name is required."),$||(e.selectedGoalId="A goal must be selected."),ea||(e.selectedTeamId="A team must be assigned.");let a=new Date;a.setHours(0,0,0,0);let n=V?new Date(V):null,r=X?new Date(X):null;return!t&&n&&n<a&&(e.startDate="Start date cannot be in the past."),n&&r&&r<n&&(e.endDate="End date must be on or after the start date."),M(e),0===Object.keys(e).length},eo=async()=>{if(K(null),!ec())return;L(!0);let a=V?new Date(V).toISOString():null,n=X?new Date(X).toISOString():null;try{t&&q?await (0,E.hm)(q,{starts_at:a,ends_at:n}):await (0,E.mK)({name:R,goal_id:$,team_id:ea,starts_at:a,ends_at:n,business_objective:"TBD",status:"UPCOMING",organization_id:"org-1"}),e.push("/team-leader-dashboard/campaign-mgmt")}catch(e){var r,i;K((null===(i=e.response)||void 0===i?void 0:null===(r=i.data)||void 0===r?void 0:r.detail)||"Failed to save the campaign. An unknown error occurred.")}finally{L(!1)}};return(0,n.jsxs)(c.Z,{sx:{display:"flex",minHeight:"100vh",backgroundColor:"background.default"},children:[(0,n.jsx)(s.q,{activeItem:"campaign-mgmt"}),(0,n.jsxs)(c.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",marginLeft:"280px"},children:[(0,n.jsx)(o.Z,{position:"static",elevation:1,sx:{backgroundColor:"background.paper",color:"text.primary"},children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{onClick:()=>e.push("/team-leader-dashboard/campaign-mgmt"),children:(0,n.jsx)(_.Z,{})}),(0,n.jsx)(h.Z,{variant:"h6",sx:{ml:2,flexGrow:1},children:P}),(0,n.jsx)(m.Z,{variant:"contained",startIcon:B?(0,n.jsx)(g.Z,{size:20,color:"inherit"}):(0,n.jsx)(I.Z,{}),onClick:eo,disabled:B,children:B?"Saving...":"Save Campaign"})]})}),(0,n.jsxs)(x.Z,{maxWidth:"xl",sx:{flexGrow:1,py:3},children:[(0,n.jsx)(l.O,{}),H&&(0,n.jsx)(p.Z,{severity:"error",sx:{mb:2},children:H}),(0,n.jsx)(f.Z,{children:(0,n.jsxs)(j.Z,{sx:{p:4},children:[(0,n.jsx)(h.Z,{variant:"h5",fontWeight:600,gutterBottom:!0,children:"Campaign Configuration"}),(0,n.jsxs)(Z.Z,{container:!0,spacing:4,sx:{mt:1},children:[(0,n.jsxs)(Z.Z,{item:!0,xs:12,md:6,children:[(0,n.jsx)(v.Z,{fullWidth:!0,sx:{mb:3},children:(0,n.jsx)(y.Z,{label:"Campaign Name",value:R,onChange:e=>U(e.target.value),required:!0,disabled:t,error:!!Q.campaignName,helperText:Q.campaignName||"A unique, human-readable name for this campaign"})}),(0,n.jsxs)(c.Z,{children:[(0,n.jsx)(h.Z,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Campaign Duration"}),(0,n.jsxs)(Z.Z,{container:!0,spacing:2,children:[(0,n.jsx)(Z.Z,{item:!0,xs:6,children:(0,n.jsx)(y.Z,{label:"Start Date",type:"date",value:V,onChange:e=>J(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,error:!!Q.startDate,helperText:Q.startDate})}),(0,n.jsx)(Z.Z,{item:!0,xs:6,children:(0,n.jsx)(y.Z,{label:"End Date",type:"date",value:X,onChange:e=>Y(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,error:!!Q.endDate,helperText:Q.endDate})})]})]})]}),(0,n.jsxs)(Z.Z,{item:!0,xs:12,md:6,children:[(0,n.jsxs)(v.Z,{fullWidth:!0,sx:{mb:3},required:!0,error:!!Q.selectedGoalId,children:[(0,n.jsx)(b.Z,{children:"Goal Selection"}),(0,n.jsx)(w.Z,{value:$,onChange:e=>ee(e.target.value),label:"Goal Selection",disabled:t,children:en.map(e=>(0,n.jsx)(C.Z,{value:e.goal_id,children:(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(D.Z,{sx:{fontSize:16}}),e.goal_name," (v",e.active_version_no,")"]})},e.goal_id))}),Q.selectedGoalId&&(0,n.jsx)(S.Z,{children:Q.selectedGoalId})]}),(0,n.jsxs)(v.Z,{fullWidth:!0,required:!0,error:!!Q.selectedTeamId,children:[(0,n.jsx)(b.Z,{children:"Team Assignment"}),(0,n.jsx)(w.Z,{value:ea,onChange:e=>et(e.target.value),label:"Team Assignment",disabled:t,children:ei.map(e=>(0,n.jsx)(C.Z,{value:e.id,children:(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(k.Z,{sx:{fontSize:16}}),e.name]})},e.id))}),Q.selectedTeamId&&(0,n.jsx)(S.Z,{children:Q.selectedTeamId})]})]})]})]})})]})]})]})}function q(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,n.jsx)(g.Z,{})}),children:(0,n.jsx)(N,{})})}},6159:function(e,a,t){"use strict";t.d(a,{E6:function(){return r},QF:function(){return s},bO:function(){return i},hm:function(){return c},mK:function(){return l}});var n=t(4633);let r=async function(){let{skip:e=0,limit:a=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await n.Z.get("/api/v1/campaigns/",{params:{skip:e,limit:a}})).data}catch(e){throw console.error("Failed to fetch campaigns:",e),Error("Could not fetch campaigns.")}},i=async e=>{try{await n.Z.delete("/api/v1/campaigns/".concat(e))}catch(a){throw console.error("Failed to delete campaign ".concat(e,":"),a),Error("Could not delete the campaign.")}},s=async e=>{try{return(await n.Z.get("/api/v1/campaigns/".concat(e))).data}catch(a){throw console.error("Failed to fetch campaign ".concat(e,":"),a),Error("Could not fetch campaign details.")}},l=async e=>{try{return(await n.Z.post("/api/v1/campaigns/",e)).data}catch(e){throw console.error("Failed to create campaign:",e),Error("Could not create campaign.")}},c=async(e,a)=>{try{return(await n.Z.put("/api/v1/campaigns/".concat(e),a)).data}catch(a){throw console.error("Failed to update campaign ".concat(e,":"),a),Error("Could not update campaign.")}}},1273:function(e,a,t){"use strict";t.d(a,{q:function(){return r}});var n=t(4633);let r=async()=>{try{return(await n.Z.get("/api/v1/goals/utils/teams")).data}catch(e){throw console.error("Failed to fetch teams:",e),Error("Could not fetch teams.")}}}},function(e){e.O(0,[334,103,118,362,835,546,618,971,117,744],function(){return e(e.s=9935)}),_N_E=e.O()}]);